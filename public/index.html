<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rammerhead Clone</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="tabs" id="tabBar"></div>

<div style="display:flex; padding:5px; background:#ddd;">
  <input type="text" id="address" placeholder="Enter URL" />
  <button id="go">Go</button>
  <button id="newTab">New Tab</button>
</div>

<iframe id="tabFrame" sandbox="allow-same-origin allow-scripts allow-popups"></iframe>
<div id="devTools">DevTools logs...</div>

<script>
const tabBar = document.getElementById("tabBar");
const frame = document.getElementById("tabFrame");
const address = document.getElementById("address");
const goBtn = document.getElementById("go");
const newTabBtn = document.getElementById("newTab");
const devTools = document.getElementById("devTools");

let tabs = [];
let activeTab = null;

function logDev(message) {
  devTools.textContent += message + "\n";
  devTools.scrollTop = devTools.scrollHeight;
}

function createTab(url="https://www.google.com") {
  const tab = { id: Date.now(), url };
  tabs.push(tab);
  activeTab = tab;
  renderTabs();
  loadTab(tab);
}

function renderTabs() {
  tabBar.innerHTML = "";
  tabs.forEach(t => {
    const el = document.createElement("div");
    el.className = "tab" + (t===activeTab ? " active":"");
    el.textContent = t.url.split("/")[2] || t.url;
    const close = document.createElement("span");
    close.textContent = "Ã—";
    close.className = "close";
    close.onclick = (e) => { e.stopPropagation(); closeTab(t.id); };
    el.appendChild(close);
    el.onclick = () => { activeTab = t; loadTab(t); renderTabs(); };
    tabBar.appendChild(el);
  });
}

function loadTab(tab) {
  if(!tab) return;
  const proxyURL = "/api/proxy?url=" + encodeURIComponent(tab.url);
  frame.src = proxyURL;
  address.value = tab.url;
  logDev(`Loaded tab: ${tab.url}`);
}

function closeTab(id) {
  tabs = tabs.filter(t => t.id !== id);
  if(activeTab && activeTab.id === id) activeTab = tabs[tabs.length-1] || null;
  renderTabs();
  if(activeTab) loadTab(activeTab);
}

goBtn.onclick = () => {
  if(activeTab) {
    activeTab.url = address.value.startsWith("http") ? address.value : "https://" + address.value;
    loadTab(activeTab);
    renderTabs();
  }
};

newTabBtn.onclick = () => createTab("https://www.google.com");

// Start with one tab
createTab();
</script>

</body>
</html>
